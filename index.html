<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Spanish Vocab Practice</title>
  <style>
    :root {
      --bg: #071029;
      --card: #0f1630;
      --muted: #9fb0e6;
      --ink: #eaf0ff;
      --accent: #6ea8ff;
      --good: #40d77e;
      --bad: #ff6b6b;
      --glass: rgba(255,255,255,0.04);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color: var(--ink); background: linear-gradient(180deg, #071029 0%, #071029 40%, #041225 100%); display: grid; place-items: center; padding: 28px; }
    .app { width: min(980px, 96vw); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius: 18px; padding: 22px; border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 18px 60px rgba(2,6,23,0.6); }
    header { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 14px; }
    h1 { margin: 0; font-size: 20px; }
    .subtitle { color: var(--muted); font-size: 13px; }
    .card { background: var(--card); border-radius: 14px; padding: 20px; border: 1px solid rgba(255,255,255,0.04); display: grid; gap: 14px; }
    .row { display: flex; gap: 12px; align-items: center; }
    .controls { display: flex; gap: 8px; flex-wrap: wrap; }
    .pill { background: var(--glass); padding: 8px 12px; border-radius: 999px; font-size: 13px; color: var(--muted); border: 1px solid rgba(255,255,255,0.03); }
    .prompt-wrap { display: grid; gap: 6px; align-items: center; }
    .dir { color: var(--muted); font-size: 13px; text-align: center; }
    .prompt { font-size: 24px; font-weight: 600; text-align: center; }
    .answer-area { display: flex; align-items: center; gap: 10px; }
    input[type=text] { flex: 1; padding: 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.06); background: rgba(0,0,0,0.25); font-size: 18px; color: var(--ink); outline: none; text-align: center; }
    .btnrow { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
    button { background: var(--accent); color: #041225; border: none; padding: 10px 14px; border-radius: 10px; font-weight: 700; cursor: pointer; box-shadow: 0 6px 18px rgba(110,168,255,0.14); transition: transform .12s ease; }
    button.secondary { background: transparent; color: var(--muted); border: 1px solid rgba(255,255,255,0.04); }
    button.ghost { background: transparent; color: var(--muted); border: 1px dashed rgba(255,255,255,0.04); }
    button:active { transform: translateY(1px); }
    .feedback { min-height: 36px; text-align: center; font-weight: 600; }
    .ok { color: var(--good); }
    .no { color: var(--bad); }
    .hint { color: var(--muted); font-weight: 500; }
    .footer { display: flex; justify-content: space-between; align-items: center; gap: 12px; }
    .admin-panel { display: none; background: var(--card); border-radius: 14px; padding: 20px; border: 1px solid rgba(255,255,255,0.04); margin-top: 14px; }
    .admin-panel.show { display: block; }
    .form-group { margin-bottom: 10px; }
    label { display: block; margin-bottom: 5px; color: var(--ink); }
    textarea { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.06); background: rgba(0,0,0,0.25); color: var(--ink); resize: vertical; }
    select { padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.06); background: rgba(0,0,0,0.25); color: var(--ink); }
    input[type=password] { padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.06); background: rgba(0,0,0,0.25); color: var(--ink); }
    .small { font-size: 13px; color: var(--muted); }
    @media (max-width: 700px) { .prompt { font-size: 20px; } input[type=text] { font-size: 16px; padding: 12px; } }
  </style>
</head>
<body>
  <div class="app" role="application">
    <header>
      <div>
        <h1>Spanish Vocab Practice</h1>
        <div class="subtitle">Select a chapter and press Start. Admin for adding vocab (password protected).</div>
      </div>
      <div style="display: flex; gap: 8px; align-items: center;">
        <select id="chapterSelect" class="pill" style="background: var(--glass); border: 1px solid rgba(255,255,255,0.03); color: var(--muted);">
          <!-- Chapters will be populated by JS -->
        </select>
        <button id="adminBtn" class="secondary">Admin</button>
      </div>
    </header>

    <main class="card" id="card">
      <div class="row" style="justify-content:center">
        <div class="pill" id="progressPill">0 / 0</div>
        <div class="pill" id="streakPill">Streak: 0</div>
      </div>

      <div class="prompt-wrap">
        <div class="dir" id="direction">Select chapter and press Start</div>
        <div class="prompt" id="prompt">—</div>
      </div>

      <div class="answer-area">
        <input id="answer" type="text" placeholder="Type your answer (press Enter)" autocomplete="off" />
      </div>

      <div class="btnrow">
        <button id="checkBtn">Check (Enter)</button>
        <button id="idkBtn" class="secondary">I don't know</button>
        <button id="showBtn" class="ghost">Show answer</button>
        <button id="stopBtn" class="secondary">Stop showing</button>
        <button id="skipBtn" class="secondary">Next</button>
        <button id="startBtn">Start</button>
      </div>

      <div class="feedback" id="feedback"></div>

      <div class="footer" style="margin-top:6px">
        <div class="subtitle">Tip: Arrow → moves to next (unless the answer is locked).</div>
        <div style="display:flex;gap:8px"><div class="pill">Random direction</div></div>
      </div>

      <div class="admin-panel" id="adminPanel" aria-hidden="true">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <div class="small">Admin: default password is <strong>admin</strong>. Change it below.</div>
          <button id="closeAdmin" class="secondary">Close</button>
        </div>

        <div class="form-group">
          <label>Select or type chapter name</label>
          <div style="display:flex;gap:8px;align-items:flex-start">
            <input id="adminChapter" type="text" placeholder="e.g. Chapter 4" style="flex:1" />
            <button id="removeChapterBtn" class="secondary" style="white-space:nowrap">Remove Chapter</button>
          </div>
        </div>

        <div class="form-group" style="display:flex;gap:8px">
          <div style="flex:1">
            <label>Spanish (term)</label>
            <input id="adminEs" type="text" placeholder="Spanish term" />
          </div>
          <div style="flex:1">
            <label>English (definition)</label>
            <input id="adminEn" type="text" placeholder="English translation" />
          </div>
        </div>

        <div class="form-group" style="display:flex;gap:8px;align-items:center">
          <input id="adminPassword" type="password" placeholder="admin password" />
          <button id="addVocabBtn">Add vocab</button>
        </div>

        <hr />

        <div class="form-group">
          <label>Paste Quizlet text here (tab separated or alternating lines)</label>
          <textarea id="quizletText" rows="6" placeholder="term[TAB]definition\nor\nterm\ndefinition\nterm\ndefinition"></textarea>
        </div>
        <div class="form-group" style="display:flex;gap:8px;align-items:center">
          <input id="quizletPassword" type="password" placeholder="admin password" />
          <button id="importQuizletBtn">Import Quizlet</button>
        </div>

        <hr />

        <!-- GitHub Gist sync: publish and sync chapters -->
        <div class="form-group">
          <label>Cloud sync (GitHub Gist) — publish / sync chapters</label>
          <div style="display:flex;gap:8px;align-items:center">
            <input id="gistId" type="text" placeholder="Gist ID (leave blank to create)" style="flex:1" />
            <input id="githubToken" type="password" placeholder="GitHub token (optional)" style="flex:1" />
          </div>
          <div class="small" style="margin-top:6px;color:var(--muted)">
            To publish or update a gist you can provide a GitHub token (gist scope). If you leave it blank the app will attempt unauthenticated requests (rate-limited) — note: updating an existing gist requires a token from the owner. Token is stored in your browser localStorage if used.
          </div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="publishGistBtn">Publish to Gist</button>
            <button id="syncGistBtn" class="secondary">Sync from Gist</button>
          </div>

          <div style="display:flex;gap:8px;margin-top:10px;align-items:center">
            <label style="margin:0"><input id="autoSync" type="checkbox" /> Auto-sync (merge) from gist every</label>
            <input id="autoSyncInterval" type="number" min="10" value="60" style="width:80px" />
            <div class="small">seconds</div>
            <label style="margin-left:12px"><input id="autoPublish" type="checkbox" /> Auto-publish on change (requires token)</label>
          </div>
        </div>

        <hr />
        <div class="form-group" style="display:flex;gap:8px;align-items:center">
          <input id="curPassword" type="password" placeholder="current password" />
          <input id="newPassword" type="password" placeholder="new password" />
          <button id="changePasswordBtn" class="secondary">Change password</button>
        </div>

        <div id="adminMsg" class="small" style="margin-top:8px;color:var(--muted)"></div>
      </div>

    </main>
  </div>

  <script>
    // --- initial chapters collected from existing files ---
    const initialChapters = {
      "Chapter 2": [
        {es:"Pues ven.", en:"So come on."},
        {es:"Vamos, anímate.", en:"Come on. Cheer up."},
        {es:"Arrancar", en:"To go / to start (a race / a car)"},
        {es:"Atreverse", en:"To dare"},
        {es:"La carrera", en:"Race"},
        {es:"Deber", en:"To owe"},
        {es:"Doler", en:"To hurt"},
        {es:"Hacer trampa", en:"To cheat"},
        {es:"Retar", en:"To challenge"},
        {es:"El truco", en:"Trick"},
        {es:"El ajedrez", en:"Chess"},
        {es:"El billar", en:"Pool / billiards"},
        {es:"El boliche", en:"Bowling"},
        {es:"Las cartas", en:"Playing cards"},
        {es:"Los naipes", en:"Playing cards"},
        {es:"El juego de mesa", en:"Board game"},
        {es:"El pasatiempo", en:"Pastime"},
        {es:"La televisión", en:"Television"},
        {es:"El tiempo libre", en:"Free time"},
        {es:"Los ratos libres", en:"Free time"},
        {es:"El videojuego", en:"Video game"},
        {es:"Aburrirse", en:"To get bored"},
        {es:"Alquilar una película", en:"To rent a movie"},
        {es:"Brindar", en:"To make a toast"},
        {es:"Celebrar", en:"To celebrate"},
        {es:"Festejar", en:"To celebrate"},
        {es:"Dar un paseo", en:"To take a stroll / walk"},
        {es:"Disfrutar de", en:"To enjoy"},
        {es:"Divertirse", en:"To have fun"},
        {es:"Entretener", en:"To entertain / to amuse"},
        {es:"Entretenerse", en:"To entertain / to amuse"},
        {es:"Gustar", en:"To like"},
        {es:"Reunirse con", en:"To get together with"},
        {es:"Salir a comer", en:"To go out to eat"},
        {es:"Aficionado", en:"Fond of / a fan of"},
        {es:"Divertido", en:"Fun"},
        {es:"Entretenido", en:"Entertaining"},
        {es:"El cine", en:"Movie theater / cinema"},
        {es:"El circo", en:"Circus"},
        {es:"La discoteca", en:"Discotheque / dance club"},
        {es:"La feria", en:"Fair"},
        {es:"El festival", en:"Festival"},
        {es:"El parque de atracciones", en:"Amusement park"},
        {es:"El zoológico", en:"Zoo"},
        {es:"El árbitro / la árbitra", en:"Referee"},
        {es:"El campeón / la campeona", en:"Champion"},
        {es:"El campeonato", en:"Championship"},
        {es:"El club deportivo", en:"Sports club"},
        {es:"El deportista / la deportista", en:"Athlete"},
        {es:"El empate", en:"Tie game"},
        {es:"El entrenador / la entrenadora", en:"Coach / trainer"},
        {es:"El equipo", en:"Team"},
        {es:"El espectador / la espectadora", en:"Spectator"},
        {es:"El torneo", en:"Tournament"},
        {es:"Anotar / marcar un gol", en:"To score a goal"},
        {es:"Anotar / marcar un punto", en:"To score a point"},
        {es:"Desafiar", en:"To challenge"},
        {es:"Empatar", en:"To tie (game)"},
        {es:"Ganar un partido", en:"To win a game"},
        {es:"Perder un partido", en:"To lose a game"},
        {es:"Vencer", en:"To defeat"},
        {es:"El álbum", en:"Album"},
        {es:"El asiento", en:"Seat"},
        {es:"El cantante / la cantante", en:"Singer"},
        {es:"El concierto", en:"Concert"},
        {es:"El conjunto", en:"Musical group / band"},
        {es:"El grupo musical", en:"Musical group / band"},
        {es:"El escenario", en:"Scenery / stage"},
        {es:"El espectáculo", en:"Show"},
        {es:"El estreno", en:"Premiere / debut"},
        {es:"La función", en:"Performance (theater / movie)"},
        {es:"El músico / la música", en:"Musician"},
        {es:"La obra de teatro", en:"Play"},
        {es:"La taquilla", en:"Box office"},
        {es:"Aplaudir", en:"To applaud"},
        {es:"Conseguir boletos", en:"To get tickets"},
        {es:"Conseguir entradas", en:"To get tickets"},
        {es:"Hacer cola", en:"To wait in line"},
        {es:"Poner un disco compacto", en:"To play a CD"},
        {es:"La aceituna", en:"Olive"},
        {es:"El familiar", en:"Relative"},
        {es:"El ganador / la ganadora", en:"Winner"},
        {es:"El gorro de lana", en:"Wool cap"},
        {es:"El pejerrey", en:"Kingfish"},
        {es:"El pique", en:"Bite"},
        {es:"El precinto", en:"Security seal"},
        {es:"La rodaja", en:"Slice"},
        {es:"El señuelo", en:"Lure"},
        {es:"El testimonio de defunción", en:"Death certificate"},
        {es:"La ventaja", en:"Advantage"},
        {es:"Envolver", en:"To wrap"},
        {es:"Hundir", en:"To sink"},
        {es:"Tejer", en:"To knit"},
        {es:"La imagen", en:"Image / picture"},
        {es:"La pantalla", en:"Screen"},
        {es:"El televisor", en:"TV set"},
        {es:"Colocar", en:"To place"},
        {es:"Señalar", en:"To point at"},
        {es:"Hondo", en:"Deep"},
        {es:"Redondo", en:"Round"},
        {es:"Por primera vez", en:"For the first time"},
        {es:"Por última vez", en:"For the last time"},
        {es:"La corrida", en:"Bullfight"},
        {es:"El matador / la matadora", en:"Bullfighter"},
        {es:"La plaza de toros", en:"Bullfighting stadium / arena"},
        {es:"El ruedo", en:"Bullring"},
        {es:"El toreo", en:"Bullfighting"},
        {es:"El torero / la torera", en:"Bullfighter"},
        {es:"El traje de luces", en:"Bullfighter's outfit"},
        {es:"Lidiar", en:"To fight (bulls)"},
        {es:"Torear", en:"To fight bulls"}
      ],
      "Chapter 3": [{"es": "¡Una ganga!", "en": "A bargain!"}, {"es": "Arruinar", "en": "To ruin"}, {"es": "La artesanía", "en": "Handicraft"}, {"es": "La broma", "en": "Joke"}, {"es": "La disculpa", "en": "Apology"}, {"es": "Humilde", "en": "Humble"}, {"es": "Pálido", "en": "Pale"}, {"es": "Retrasarse", "en": "To be delayed / to be late"}, {"es": "El balcón", "en": "Balcony"}, {"es": "La escalera", "en": "Staircase"}, {"es": "El hogar", "en": "Home / fireplace"}, {"es": "La limpieza", "en": "Cleaning"}, {"es": "Los muebles", "en": "Furniture"}, {"es": "Los quehaceres", "en": "Chores"}, {"es": "Apagar", "en": "To turn off"}, {"es": "Barrer", "en": "To sweep"}, {"es": "Calentar (e-ie)", "en": "To warm up"}, {"es": "Cocinar", "en": "To cook"}, {"es": "Encender (e-ie)", "en": "To turn on"}, {"es": "Freír (e-i)", "en": "To fry"}, {"es": "Hervir", "en": "To boil"}, {"es": "Lavar", "en": "To wash"}, {"es": "Limpiar", "en": "To clean"}, {"es": "Pasar la aspiradora", "en": "To vacuum"}, {"es": "Poner la mesa", "en": "To set the table"}, {"es": "Quitar la mesa", "en": "To clear the table"}, {"es": "Quitar el polvo", "en": "To dust"}, {"es": "Tocar el timbre", "en": "To ring the doorbell"}, {"es": "El centro comercial", "en": "Mall"}, {"es": "El dinero en efectivo", "en": "Cash"}, {"es": "La ganga", "en": "Bargain"}, {"es": "El probador", "en": "Dressing room"}, {"es": "El reembolso", "en": "Refund"}, {"es": "El supermercado", "en": "Supermarket"}, {"es": "La tarjeta de crédito", "en": "Credit card"}, {"es": "La tarjeta de débito", "en": "Debit card"}, {"es": "Devolver (o-ue)", "en": "To return (items)"}, {"es": "Hacer mandados", "en": "To run errands"}, {"es": "Ir de compras", "en": "To go shopping"}, {"es": "Probarse (o-ue)", "en": "To try on"}, {"es": "Seleccionar", "en": "To select / to pick out"}, {"es": "Auténtico", "en": "Authentic"}, {"es": "Barato", "en": "Cheap"}, {"es": "Caro", "en": "Expensive"}, {"es": "A menudo", "en": "Often"}, {"es": "A propósito", "en": "On purpose"}, {"es": "A tiempo", "en": "On time"}, {"es": "A veces", "en": "Sometimes"}, {"es": "Apenas", "en": "Hardly"}, {"es": "Así", "en": "Like this / so"}, {"es": "Bastante", "en": "Quite / enough"}, {"es": "Casi", "en": "Almost"}, {"es": "Casi nunca", "en": "Rarely"}, {"es": "De repente", "en": "Suddenly"}, {"es": "De vez en cuando", "en": "Once in a while"}, {"es": "En aquel entonces", "en": "At that time"}, {"es": "En el acto", "en": "Immediately"}, {"es": "Enseguida", "en": "Right away"}, {"es": "Por casualidad", "en": "By chance"}, {"es": "La agenda", "en": "Agenda"}, {"es": "La costumbre", "en": "Custom / habit"}, {"es": "El horario", "en": "Schedule"}, {"es": "La rutina", "en": "Routine"}, {"es": "La soledad", "en": "Loneliness"}, {"es": "Acostumbrarse a", "en": "To get used to"}, {"es": "Arreglarse", "en": "To get ready"}, {"es": "Averiguar", "en": "To find out"}, {"es": "Probar (o-ue) a", "en": "To try"}, {"es": "Soler (o-ue)", "en": "To be in the habit of"}, {"es": "Atrasado", "en": "Late"}, {"es": "Cotidiana", "en": "Everyday"}, {"es": "Diario", "en": "Daily"}, {"es": "Inesperado", "en": "Unexpected"}, {"es": "La cinta", "en": "Tape"}, {"es": "La luz", "en": "Light"}, {"es": "Alargar", "en": "To drag out"}, {"es": "Enterarse", "en": "To find out"}, {"es": "Entretenerse", "en": "To be held up"}, {"es": "Respirar", "en": "To breathe"}, {"es": "Pesado", "en": "Annoying"}, {"es": "Precioso", "en": "Lovely"}, {"es": "Turbio", "en": "Murky"}, {"es": "A lo mejor", "en": "Maybe"}, {"es": "El autorretrato", "en": "Self-portrait"}, {"es": "El maquillaje", "en": "Make-up"}, {"es": "El llanto", "en": "Crying"}, {"es": "Acariciar", "en": "To caress"}, {"es": "Llorar", "en": "To cry"}, {"es": "Lucir", "en": "To wear / to display"}, {"es": "Arduo", "en": "Hard"}, {"es": "Feliz", "en": "Happy"}, {"es": "Acaso", "en": "Perhaps"}, {"es": "El cansancio", "en": "Exhaustion"}, {"es": "El cuadro", "en": "Painting"}, {"es": "La obra maestra", "en": "Masterpiece"}, {"es": "El pintor / la pintora", "en": "Painter"}, {"es": "El retrato", "en": "Portrait"}, {"es": "Pintar", "en": "To paint"}, {"es": "Retratar", "en": "To portray"}, {"es": "Fatigado", "en": "Fatigued"}, {"es": "Imprevisto", "en": "Unexpected"}, {"es": "Previsto", "en": "Planned / expected"}],
      "Chapter 4": [
        {'es': 'Es mejor que se quede esta noche en el hospital', 'en': 'It is better that she stay at the hospital overnight.'},
        {'es': 'Es urgente que la establicemos', 'en': "It's urgent that we stabilize her."},
        {'es': '¡Espero que no sea una broma, Manu!', 'en': 'I hope this is not a joke, Manu.'},
        {'es': 'Necesito que estés tranquilo', 'en': 'I need you to stay calm.'},
        {'es': 'Necesito que pises el acelerador y vengas al hospital', 'en': 'I need you to step on the gas and get to the hospital.'},
        {'es': '¡Agárrate!', 'en': 'Hold on!'},
        {'es': '¡Détente!', 'en': 'Stop!'},
        {'es': '¡Espera!', 'en': 'Wait!'},
        {'es': '¡No seas ridícula!', 'en': "Don't be ridiculous!"},
        {'es': 'Relájese y espere acá, por favor', 'en': 'Relax and wait here, please.'},
        {'es': 'Shhh, no hagan ruido por si acaso está durmiendo', 'en': "Shhh, don't make any noise in case she's sleeping."},
        {'es': 'Arreglárselas', 'en': 'To manage to'},
        {'es': 'Detenerse', 'en': 'To stop'},
        {'es': '¡No es para tanto!', 'en': "It's not a big deal!"},
        {'es': '¡Por Dios!', 'en': "For God's sake!"},
        {'es': 'Por lo visto', 'en': 'Apparently'},
        {'es': 'La presión', 'en': '(blood) pressure'},
        {'es': 'La depresión', 'en': 'Depression'},
        {'es': 'La enfermedad', 'en': 'Disease / Illness'},
        {'es': 'La gripe', 'en': 'Flu'},
        {'es': 'La herida', 'en': 'Injury'},
        {'es': 'El malestar', 'en': 'Discomfort'},
        {'es': 'La obesidad', 'en': 'Obesity'},
        {'es': 'El resfriado', 'en': 'Cold'},
        {'es': 'La respiración', 'en': 'Breathing'},
        {'es': 'La tensión alta', 'en': 'High blood pressure'},
        {'es': 'La tensión baja', 'en': 'Low blood pressure'},
        {'es': 'La tos', 'en': 'Cough'},
        {'es': 'El virus', 'en': 'Virus'},
        {'es': 'Contagiarse', 'en': 'To become infected'},
        {'es': 'Desmayarse', 'en': 'To faint'},
        {'es': 'Empeorar', 'en': 'To get worse'},
        {'es': 'Enfermarse', 'en': 'To get sick'},
        {'es': 'Estar resfriado/a', 'en': 'To have a cold'},
        {'es': 'Lastimarse', 'en': 'To get hurt'},
        {'es': 'Permanecer', 'en': 'To remain / to last'},
        {'es': 'Ponerse bien', 'en': 'To get well'},
        {'es': 'Ponerse mal', 'en': 'To get sick'},
        {'es': 'Tener buen aspecto', 'en': 'To look healthy'},
        {'es': 'Tener mal aspecto', 'en': 'To look sick'},
        {'es': 'Toser', 'en': 'To cough'},
        {'es': 'Agotado/a', 'en': 'Exhausted'},
        {'es': 'Inflamado/a', 'en': 'Inflamed'},
        {'es': 'Mareado/a', 'en': 'Dizzy'},
        {'es': 'La alimentación', 'en': 'Diet (nutrition)'},
        {'es': 'La autoestima', 'en': 'Self-esteem'},
        {'es': 'El bienestar', 'en': 'Well-being'},
        {'es': 'El estado de ánimo', 'en': 'Mood'},
        {'es': 'La salud', 'en': 'Health'},
        {'es': 'Adelgazar', 'en': 'To lose weight'},
        {'es': 'Descansar', 'en': 'To rest'},
        {'es': 'Engordar', 'en': 'To gain weight'},
        {'es': 'Estar a dieta', 'en': 'To be on a diet'},
        {'es': 'Mejorar', 'en': 'To improve'},
        {'es': 'Prevenir', 'en': 'To prevent'},
        {'es': 'Relajarse', 'en': 'To relax'},
        {'es': 'Trasnochar', 'en': 'To stay up all night'},
        {'es': 'Sano/a', 'en': 'Healthy'},
        {'es': 'La cirugía', 'en': 'Surgery'},
        {'es': 'El cirujano / la cirujana', 'en': 'Surgeon'},
        {'es': 'La consulta', 'en': "Doctor's appointment"},
        {'es': 'El consultorio', 'en': "Doctor's office"},
        {'es': 'La operación', 'en': 'Operation'},
        {'es': 'Los primeros auxilios', 'en': 'First aid'},
        {'es': 'La sala de emergencias', 'en': 'Emergency room'}],
      "Chapter 1": [ {es:"¡Nos están espiando!", en:"Someone is spying on us!"},
        {es:"El cumpleañero / La cumpleañera", en:"Birthday boy/girl"},
        {es:"El deseo", en:"Wish"},
        {es:"Encender", en:"To turn on"},
        {es:"El espía / la espía", en:"Spy (boy/girl)"},
        {es:"Espiar", en:"To spy"},
        {es:"Estrellarse", en:"To crash"},
        {es:"La muerte", en:"Death"},
        {es:"Volador / voladora", en:"Flying"},

        {es:"Autoritario", en:"Strict"},
        {es:"Cariñoso", en:"Affectionate"},
        {es:"Celoso", en:"Jealous"},
        {es:"Cuidadoso", en:"Careful"},
        {es:"Falso", en:"Insincere"},
        {es:"Gracioso", en:"Funny"},
        {es:"Inseguro", en:"Insecure"},
        {es:"Inmaduro", en:"Immature"},
        {es:"Maduro", en:"Mature"},
        {es:"Mentiroso", en:"Lying/liar"},
        {es:"Orgulloso", en:"Proud"},
        {es:"Permisivo", en:"Permissive"},
        {es:"Seguro", en:"Sure/confident"},
        {es:"Sensible", en:"Sensitive"},
        {es:"Serio", en:"Serious"},
        {es:"Tacaño", en:"Stingy/cheap"},
        {es:"Tímido", en:"Shy"},
        {es:"Tradicional", en:"Traditional"},

        {es:"Agobiado", en:"Overwhelmed"},
        {es:"Ansioso", en:"Anxious"},
        {es:"Deprimido", en:"Depressed"},
        {es:"Disgustado", en:"Upset"},
        {es:"Emocionado", en:"Excited"},
        {es:"Preocupado por", en:"Worried about"},
        {es:"Solo", en:"Alone/lonely"},
        {es:"Tranquilo", en:"Calm"},

        {es:"Adorar", en:"To adore"},
        {es:"Apreciar", en:"To think highly of / to appreciate"},
        {es:"Enamorarse de", en:"To fall in love with"},
        {es:"Estar harto de", en:"To be sick of / 'to have it up to here'"},
        {es:"Odiar", en:"To hate"},
        {es:"Sentirse (e→ie)", en:"To feel"},
        {es:"Soñar con (o→ue)", en:"To dream about"},
        {es:"Tener celos de", en:"To be jealous of"},
        {es:"Tener vergüenza de", en:"To be embarrassed about"},

        {es:"El amado / La amada", en:"Loved one"},
        {es:"El ánimo", en:"Spirit"},
        {es:"El cariño", en:"Affection"},
        {es:"La cita", en:"Date"},
        {es:"La cita a ciegas", en:"Blind date"},
        {es:"El compromiso", en:"Commitment"},
        {es:"La confianza", en:"Trust / confidence"},
        {es:"El desánimo", en:"The state of being discouraged"},
        {es:"El divorcio", en:"Divorce"},
        {es:"La pareja", en:"Couple / partner"},
        {es:"El sentimiento", en:"Feeling"},
        {es:"Atraer", en:"To attract"},
        {es:"Coquetear", en:"To flirt"},
        {es:"Cuidar", en:"To take care of"},
        {es:"Dejar a alguien", en:"To leave someone"},
        {es:"Discutir", en:"To argue"},
        {es:"Educar", en:"To raise / to bring up"},
        {es:"Hacerle caso a alguien", en:"To pay attention to someone"},
        {es:"Impresionar", en:"To impress"},
        {es:"Llevar...años de casados", en:"To be (married) for ___ years"},
        {es:"Llevarse bien", en:"To get along well"},
        {es:"Llevarse mal", en:"To get along badly"},
        {es:"Llevarse fatal", en:"To get along terribly"},
        {es:"Mantenerse en contacto", en:"To keep in touch"},
        {es:"Pasarlo bien", en:"To have a good time"},
        {es:"Pasarlo mal", en:"To have a bad time"},
        {es:"Pasarlo fatal", en:"To have a terrible time"},
        {es:"Proponer matrimonio", en:"To propose marriage"},
        {es:"Romper con", en:"To break up with"},
        {es:"Salir con", en:"To go out with"},
        {es:"Soportar a alguien", en:"To put up with someone"},
        {es:"Casado", en:"Married"},
        {es:"Divorciado", en:"Divorced"},
        {es:"Separado", en:"Separated"},
        {es:"Soltero", en:"Single"},
        {es:"Viudo", en:"Widowed"},

        {es:"El bocado", en:"Bite / mouthful"},
        {es:"La caja", en:"Coffin"},
        {es:"La golpiza", en:"Beating"},
        {es:"La milpa", en:"Vegetable garden"},
        {es:"El recado", en:"Message"},
        {es:"¡Garta de chismosos!", en:"Bunch of gossips!"},
        {es:"Enterrar", en:"To bury"},
        {es:"Fallecer", en:"To die"},
        {es:"Regar las plantas", en:"To water the garden / plants"},
        {es:"Resucitar", en:"To resuscitate / to revive"},
        {es:"Toparse con", en:"To run into someone"},
        {es:"Velar a un muerto", en:"To hold a vigil / wake"},
        {es:"Harto tiempo", en:"For a long time"},

        {es:"El alma", en:"Soul"},
        {es:"El corazón", en:"Heart"},
        {es:"La mirada", en:"Gaze"},
        {es:"El olvido", en:"Oblivion"},
        {es:"Amar", en:"To love"},
        {es:"Besar", en:"To kiss"},
        {es:"Contentarse con", en:"To be satisfied with"},
        {es:"Querer", en:"To love / to want"},

        {es:"El cargo", en:"Position"},
        {es:"El clima", en:"Climate"},
        {es:"El sueño", en:"Dream"},
        {es:"Convertirse (e→ie) en", en:"To become"},
        {es:"Rechazar", en:"To reject"},
        {es:"Superar", en:"To overcome"},
        {es:"Tomar en cuenta", en:"To take into consideration"},
        {es:"Propio", en:"Own (belonging)"},
        {es:"Sabio", en:"Wise"},
        {es:"En contra", en:"Against"}],
      "Chapter 5": [
        {es:"Tampoco es para tanto", en:"It’s not a big deal."},
        {es:"¿Te pasa algo?", en:"Are you OK?"},
        {es:"Abrocharse el cinturón", en:"To fasten one’s seat belt"},
        {es:"La almohada", en:"Pillow"},
        {es:"Bajarse", en:"To get down / to get out (vehicle)"},
        {es:"Dar el alta", en:"To discharge (from hospital)"},
        {es:"¡Claro que no!", en:"Of course not!"},
        {es:"Contratar", en:"To hire"},
        {es:"¡No te metas!", en:"Don’t get involved!"},
        {es:"Quejarse", en:"To complain"},
        {es:"Subirse", en:"To go up / to get in (vehicle)"},
        {es:"Tener derecho a", en:"To have the right to"},

        {es:"La bienvenida", en:"Welcome"},
        {es:"La despedida", en:"Farewell"},
        {es:"El destino", en:"Destination"},
        {es:"El itinerario", en:"Itinerary"},
        {es:"La llegada", en:"Arrival"},
        {es:"El pasaje de ida", en:"One-way ticket"},
        {es:"El pasaje de ida y vuelta", en:"Round-trip ticket"},
        {es:"El pasaporte", en:"Passport"},
        {es:"La tarjeta de embarque", en:"Boarding pass"},
        {es:"La temporada alta", en:"High season"},
        {es:"La temporada baja", en:"Low season"},
        {es:"El viajero / la viajera", en:"Traveler"},
        {es:"Hacer las maletas", en:"To pack"},
        {es:"Hacer transbordo", en:"To transfer (plane/train)"},
        {es:"Hacer un viaje", en:"To take a trip"},
        {es:"Irse de vacaciones", en:"To go on vacation"},
        {es:"Perder (e→ie) el vuelo", en:"To miss the flight"},
        {es:"Regresar", en:"To return"},
        {es:"Retrasado/a", en:"Delayed"},
        {es:"Vencido/a", en:"Expired"},
        {es:"Vigente", en:"Valid"},

        {es:"El albergue", en:"Hostel"},
        {es:"El alojamiento", en:"Lodging"},
        {es:"La habitación individual", en:"Single room"},
        {es:"La habitación doble", en:"Double room"},
        {es:"La recepción", en:"Front desk"},
        {es:"El servicio de habitación", en:"Room service"},
        {es:"Alojarse", en:"To stay"},
        {es:"Cancelar", en:"To cancel"},
        {es:"Estar lleno/a", en:"To be full"},
        {es:"Quedarse", en:"To stay"},
        {es:"Reservar", en:"To reserve"},
        {es:"De buena categoría", en:"First rate"},
        {es:"Incluido/a", en:"Included"},
        {es:"Recomendable", en:"Advisable"},

        {es:"El accidente", en:"Accident"},
        {es:"El accidente automovilístico", en:"Auto accident"},
        {es:"El agente de aduanas / la agente de aduanas", en:"Customs agent"},
        {es:"El aviso", en:"Notice / warning"},
        {es:"El cinturón de seguridad", en:"Seatbelt"},
        {es:"El congestionamiento", en:"Traffic jam"},
        {es:"Las medidas de seguridad", en:"Security measures"},
        {es:"La seguridad", en:"Safety / security"},
        {es:"El seguro", en:"Insurance"},
        {es:"Despegar", en:"To take off"},
        {es:"Ponerse el cinturón", en:"To fasten the seatbelt"},
        {es:"Quitarse el cinturón", en:"To unfasten the seatbelt"},
        {es:"Reducir la velocidad", en:"To reduce speed"},
        {es:"Peligroso/a", en:"Dangerous"},
        {es:"Prohibido/a", en:"Prohibited"},

        {es:"La aventura", en:"Adventure"},
        {es:"El aventurero / la aventurera", en:"Adventurer"},
        {es:"La brújula", en:"Compass"},
        {es:"El buceo", en:"Scuba diving"},
        {es:"El campamento", en:"Campground"},
        {es:"El crucero", en:"Cruise (ship)"},
        {es:"El turismo", en:"Tourism"},
        {es:"El ecoturismo", en:"Ecotourism"},
        {es:"La excursión", en:"Outing / tour"},
        {es:"La frontera", en:"Border"},
        {es:"El guía turístico / la guía turística", en:"Tour guide"},
        {es:"La isla", en:"Island"},
        {es:"Las olas", en:"Waves (of water)"},
        {es:"El puerto", en:"Port"},
        {es:"Las ruinas", en:"Ruins"},
        {es:"La selva", en:"Jungle"},
        {es:"El/la turista", en:"Tourist"},
        {es:"Navegar", en:"To sail"},
        {es:"Recorrer", en:"To tour"},
        {es:"Lejano/a", en:"Distant"},
        {es:"Turístico/a", en:"Tourist (adj.)"},

        {es:"El carné de conducir", en:"Driver’s license"},
        {es:"La molestia", en:"Annoyance"},
        {es:"El permiso de circulación", en:"Car registration"},
        {es:"Denunciar", en:"To report"},
        {es:"Descargar", en:"To unload"},
        {es:"Jurar", en:"To swear (to tell the truth, the whole truth…)"},
        {es:"¡Menuda paliza!", en:"What a hassle! (fig.)"},
        {es:"¿Me permite?", en:"May I?"},
        {es:"Ni se le ocurra", en:"Don’t you dare"},
        {es:"Sin novedad", en:"No news"},

        {es:"La bahía", en:"Bay"},
        {es:"El bote", en:"Boat"},
        {es:"La cascada", en:"Cascade / waterfall"},
        {es:"El faro", en:"Lighthouse"},
        {es:"El muelle", en:"Pier"},
        {es:"La pesca", en:"Fishing"},
        {es:"La popa", en:"Stern (back of boat)"},
        {es:"La proa", en:"Bow (front of boat)"},
        {es:"El remo", en:"Oar"},
        {es:"El tiburón", en:"Shark"},
        {es:"Flotar", en:"To float"},
        {es:"Ahogado/a", en:"Drowned"},

        {es:"El apogeo", en:"Height / highest level"},
        {es:"El artefacto", en:"Artifact"},
        {es:"El campo de pelota", en:"Ball field"},
        {es:"El dios / la diosa", en:"God / goddess"},
        {es:"El juego de pelota", en:"Ball game"},
        {es:"La leyenda", en:"Legend"},
        {es:"El mito", en:"Myth"},
        {es:"La pared", en:"Wall"},
        {es:"La piedra", en:"Stone"},
        {es:"La pirámide", en:"Pyramid"},
        {es:"La ruta maya", en:"The Mayan Trail"},
        {es:"¡Esto es el colmo!", en:"This is the last straw!"},
        {es:"¡Ni lo sueñes!", en:"Don't even dream about it!"},
        {es:"El cajero automático", en:"ATM"},
        {es:"La cuenta corriente", en:"Checking account"},
        {es:"La cuenta de ahorros", en:"Savings account"},
        {es:"El estado de cuenta", en:"Bank statement"},
        {es:"El extracto", en:"Statement"},
        {es:"El préstamo", en:"Loan"},
        {es:"La tasa de interés", en:"Interest rate"},
        {es:"Transferir", en:"To transfer"},
        {es:"Disponer de", en:"To have at one's disposal"},
        {es:"Hacer diligencias", en:"To run errands"},

        {es:"El anuncio clasificado", en:"Classified ad"},
        {es:"El/la aspirante", en:"Applicant / candidate"},
        {es:"El currículum (vitae)", en:"Résumé / CV"},
        {es:"La entrevista de trabajo", en:"Job interview"},
        {es:"El puesto", en:"Position / job"},
        {es:"La referencia", en:"Reference"},
        {es:"Contratar", en:"To hire"},
        {es:"Despedir (e→i)", en:"To fire / to dismiss"},
        {es:"Ganar bien/mal", en:"To earn well/poorly"},
        {es:"Renunciar", en:"To resign"}
      ],
      "Chapter 6": [
        {es:"Mejor volvamos a casa", en:"We had better go back home"},
        {es:"La cascada", en:"Waterfall"},
        {es:"En detallito", en:"A little something"},
        {es:"Merecer", en:"To deserve"},
        {es:"La prisa", en:"Rush"},
        {es:"El reino animal", en:"Animal kingdom"},
        {es:"Rodeado/a de", en:"Surrounded by"},

        {es:"Andar como perro sin pulga", en:"To be carefree (like a dog without fleas)"},
        {es:"Comer como un chancho", en:"To eat like a pig"},
        {es:"¡El mono está chiflando!", en:"How windy! (the monkey is whistling)"},
        {es:"Estar como una cabra", en:"To be as mad as a hatter (to be like a goat)"},
        {es:"Marca perro", en:"(of an object) by an unknown brand (marking dog territory)"},
        {es:"¡Me pica el bagre!", en:"I'm getting hungry! (the catfish is itching me)"},
        {es:"¡Qué tortuga!", en:"How slow! (what a tortoise)"},
        {es:"Ser un(a) rata", en:"To be stingy (to be a rat)"},
        {es:"¡Qué búfalo!", en:"Fantastic! (what a buffalo)"},

        {es:"El árbol", en:"Tree"},
        {es:"El arrecife", en:"Reef"},
        {es:"El bosque", en:"Forest"},
        {es:"El bosque lluvioso", en:"Rain forest"},
        {es:"El campo", en:"Countryside / field"},
        {es:"La cordillera", en:"Mountain range"},
        {es:"El desierto", en:"Desert"},
        {es:"El mar", en:"Sea"},
        {es:"La montaña", en:"Mountain"},
        {es:"El paisaje", en:"Landscape / scenery"},
        {es:"La tierra", en:"Land / earth"},
        {es:"Húmedo/a", en:"Humid"},
        {es:"Seco/a", en:"Dry"},
        {es:"A orillas de", en:"On the shore of"},
        {es:"Al aire libre", en:"Outdoors"},

        {es:"El ave (f.)", en:"Bird"},
        {es:"El pájaro", en:"Bird"},
        {es:"El cerdo", en:"Pig"},
        {es:"El conejo", en:"Rabbit"},
        {es:"El león", en:"Lion"},
        {es:"El mono", en:"Monkey"},
        {es:"La oveja", en:"Sheep"},
        {es:"El pez", en:"Fish (alive and swimming)"},
        {es:"La rana", en:"Frog"},
        {es:"La serpiente", en:"Snake"},
        {es:"El tigre", en:"Tiger"},
        {es:"La vaca", en:"Cow"},
        {es:"Atrapar", en:"To trap / to catch"},
        {es:"Cazar", en:"To hunt"},
        {es:"Dar de comer", en:"To feed"},
        {es:"Extinguirse", en:"To become extinct"},
        {es:"En peligro de extinción", en:"Endangered"},
        {es:"Salvaje", en:"Wild / savage"},
        {es:"Venenoso/a", en:"Poisonous / venomous"},

        {es:"El huracán", en:"Hurricane"},
        {es:"El incendio", en:"Fire"},
        {es:"La inundación", en:"Flood"},
        {es:"El relámpago", en:"Lightning"},
        {es:"La sequía", en:"Drought"},
        {es:"El terremoto", en:"Earthquake"},
        {es:"La tormenta", en:"Storm"},
        {es:"La tormenta tropical", en:"Tropical storm"},
        {es:"El trueno", en:"Thunder"},

        {es:"El calentamiento global", en:"Global warming"},
        {es:"La capa de ozono", en:"Ozone layer"},
        {es:"El combustible", en:"Fuel"},
        {es:"La contaminación", en:"Pollution"},
        {es:"La deforestación", en:"Deforestation"},
        {es:"El desarrollo", en:"Development"},
        {es:"La erosión", en:"Erosion"},
        {es:"La fuente de energía", en:"Energy source"},
        {es:"El medio ambiente", en:"Environment"},
        {es:"Los recursos naturales", en:"Natural resources"},
        {es:"Agotar", en:"To use up"},
        {es:"Conservar", en:"To conserve"},
        {es:"Contaminar", en:"To pollute"},
        {es:"Contribuir", en:"To contribute"},
        {es:"Desaparecer", en:"To disappear"},
        {es:"Destruir", en:"To destroy"},
        {es:"Malgastar", en:"To waste"},
        {es:"Proteger", en:"To protect"},
        {es:"Reciclar", en:"To recycle"},
        {es:"Resolver (o→ue)", en:"To resolve"},
        {es:"Dañino/a", en:"Harmful"},
        {es:"Desechable", en:"Disposable"},
        {es:"Renovable", en:"Renewable"},
        {es:"Tóxico/a", en:"Toxic"},

        {es:"Caber", en:"To fit"},
        {es:"Haber", en:"To have (done something)"},
        {es:"Poder", en:"To be able to"},
        {es:"Querer", en:"To want"},
        {es:"Saber", en:"To know (stuff)"},
        {es:"Poner", en:"To put"},
        {es:"Salir", en:"To leave"},
        {es:"Tener", en:"To have"},
        {es:"Valer", en:"To value"},
        {es:"Venir", en:"To come"},
        {es:"Decir", en:"To say / to tell"},
        {es:"Hacer", en:"To do / to make"},
        {es:"Satisfacer", en:"To satisfy"},

        {es:"El aliado / la aliada", en:"Ally"},
        {es:"El asombro", en:"Astonishment"},
        {es:"El buceo", en:"Diving"},
        {es:"El buzo", en:"Diver"},
        {es:"La hembra", en:"Female (animal)"},
        {es:"El manglar", en:"Mangrove swamp"},
        {es:"La veda", en:"Closed season / ban (for fishing)"},
        {es:"Dar a luz", en:"To give birth"},
        {es:"Darse la vuelta", en:"To turn back"},
        {es:"Preñada", en:"Pregnant"},
        {es:"Enfrente de", en:"Facing"},

        {es:"La esperanza", en:"Hope"},
        {es:"La prisa", en:"Hurry"},
        {es:"Disponerse a", en:"To be about to"},
        {es:"Florecer", en:"To blossom / to bloom"},
        {es:"Oscurecer", en:"To darken"},
        {es:"Prever", en:"To foresee"},
        {es:"Sacrificar", en:"To sacrifice"},
        {es:"Salvar", en:"To save"},
        {es:"Aislado", en:"Isolated"},
        {es:"Digno/a", en:"Worthy"},
        {es:"Valioso/a", en:"Valuable"},

        {es:"El bombardeo", en:"Bombing"},
        {es:"El ecosistema", en:"Ecosystem"},
        {es:"La especie", en:"Species"},
        {es:"El manifestante / la manifestante", en:"Protester"},
        {es:"El monte", en:"Mountain"},
        {es:"La pureza", en:"Purity"},
        {es:"El refugio", en:"Refuge"},
        {es:"El terreno", en:"Land"},
        {es:"El veneno", en:"Poison / venom"},
        {es:"Ambiental", en:"Environmental"}
      ],
      "Chapter 7": [
        {es:"Arreglar", en:"To fix"},
        {es:"La camioneta", en:"Pickup truck"},
        {es:"Estrellar", en:"To crash"},
        {es:"Funcionar", en:"To work (function; not job)"},
        {es:"La herramienta", en:"Tool"},
        {es:"Un montón", en:"A lot"},
        {es:"La señal", en:"Signal"},
        {es:"Las caricaturas (Colombia/Mexico)", en:"Cartoons"},
        {es:"Los dibujitos (Argentina)", en:"Cartoons"},
        {es:"Los muñequitos (Cuba)", en:"Cartoons"},
        {es:"Las películas CG", en:"CG movies"},
        {es:"El laptop / la laptop (Latin America)", en:"Laptop"},
        {es:"La notebook (Argentina)", en:"Laptop"},
        {es:"El portátil (Spain)", en:"Laptop"},
        {es:"La computadora (Colombia y Chile)", en:"Computer"},
        {es:"El ordenador (Spain)", en:"Computer"},
        {es:"El mouse (Latin America)", en:"Mouse (computer)"},
        {es:"El ratón (Spain y Peru)", en:"Mouse (computer)"},
        {es:"La birome (Argentina)", en:"Ballpoint pen"},
        {es:"El frasco", en:"Bottle"},
        {es:"La jeringa descartable", en:"Disposable syringe"},
        {es:"La masa cruda", en:"Raw dough"},
        {es:"La pluma", en:"Fountain pen (feather quill pen)"},
        {es:"La sangre", en:"Blood"},
        {es:"El subterráneo", en:"Subway"},
        {es:"La tinta", en:"Ink"},
        {es:"La arroba", en:"The @ symbol"},
        {es:"El blog", en:"Blog"},
        {es:"El buscador", en:"Search engine"},
        {es:"La computadora portátil", en:"Laptop"},
        {es:"La contraseña", en:"Password"},
        {es:"El corrector ortográfico", en:"Spell check"},
        {es:"La dirección de correo electrónico", en:"E-mail address"},
        {es:"La informática", en:"Computer science"},
        {es:"El mensaje de texto", en:"Text message"},
        {es:"El mensaje", en:"Message"},
        {es:"La página web", en:"Web page"},
        {es:"El programa", en:"Software"},
        {es:"El programa de computación", en:"Software"},
        {es:"El reproductor de CD", en:"CD player"},
        {es:"El reproductor de DVD", en:"DVD player"},
        {es:"El reproductor de MP3", en:"MP3 player"},
        {es:"El teléfono", en:"Telephone"},
        {es:"El teléfono celular", en:"Cell phone"},
        {es:"Adjuntar", en:"To attach"},
        {es:"Adjuntar un archivo", en:"To attach a file"},
        {es:"Borrar", en:"To erase"},
        {es:"Chatear", en:"To chat (online)"},
        {es:"Descargar", en:"To download"},
        {es:"Guardar", en:"To save"},
        {es:"Navegar en la red", en:"To surf the web"},
        {es:"Tuitear", en:"To Tweet (Twitter)"},
        {es:"Digital", en:"Digital"},
        {es:"En línea", en:"Online"},
        {es:"Inalámbrico/a", en:"Wireless"},
        {es:"El agujero negro", en:"Black hole"},
        {es:"El cohete", en:"Rocket"},
        {es:"El cometa", en:"Comet"},
        {es:"El espacio", en:"Space"},
        {es:"La estrella", en:"Star"},
        {es:"La estrella fugaz", en:"Shooting star"},
        {es:"El extraterrestre/la extraterrestre", en:"Alien"},
        {es:"La gravedad", en:"Gravity"},
        {es:"El ovni (objeto volante no identificado)", en:"UFO (unidentified flying object)"},
        {es:"El telescopio", en:"Telescope"},
        {es:"El transbordador espacial", en:"Space shuttle"},
        {es:"El astronauta/la astronauta", en:"Astronaut"},
        {es:"El astrónomo/la astrónoma", en:"Astronomer"},
        {es:"El biólogo/la bióloga", en:"Biologist"},
        {es:"El científico/la científica", en:"Scientist"},
        {es:"El físico/la física", en:"Physicist"},
        {es:"El ingeniero/la ingeniera", en:"Engineer"},
        {es:"El matemático/la matemática", en:"Mathematician"},
        {es:"El bioquímico/la bioquímica", en:"Biochemist"},
        {es:"El químico/la química", en:"Chemist"},
        {es:"El ADN (ácido desoxirribonucleico)", en:"DNA (deoxyribonucleic acid)"},
        {es:"El avance", en:"Advance"},
        {es:"La célula", en:"Cell"},
        {es:"El desafío", en:"Challenge"},
        {es:"El descubrimiento", en:"Discovery"},
        {es:"El experimento", en:"Experiment"},
        {es:"El gen", en:"Gene"},
        {es:"El invento", en:"Invention"},
        {es:"La patente", en:"Patent"},
        {es:"La teoría", en:"Theory"},
        {es:"Clonar", en:"To clone"},
        {es:"Comprobar (o-ue)", en:"To prove"},
        {es:"Crear", en:"To create"},
        {es:"Fabricar", en:"To manufacture"},
        {es:"Formular", en:"To formulate"},
        {es:"Inventar", en:"To invent"},
        {es:"Investigar", en:"To investigate / to research"},
        {es:"Avanzado/a", en:"Advanced"},
        {es:"Bioquímico/a", en:"Biochemical"},
        {es:"Químico/a", en:"Chemical"},
        {es:"Especializado/a", en:"Specialized"},
        {es:"Ético", en:"Ethical"},
        {es:"Innovador/a", en:"Innovative"},
        {es:"Revolucionario/a", en:"Revolutionary"},
        {es:"La guita", en:"Cash / dough"},
        {es:"El interrogante", en:"Question / doubt"},
        {es:"La plata", en:"Money (silver)"},
        {es:"El vago/la vaga", en:"Slacker"},
        {es:"Vos", en:"Tú"},
        {es:"Congelar", en:"To freeze"},
        {es:"Congelarse", en:"To freeze self"},
        {es:"Derretir", en:"To melt"},
        {es:"Derretirse", en:"To melt self"},
        {es:"Descongelar", en:"To defrost"},
        {es:"Descongelarse", en:"To defrost self"},
        {es:"Hacer clic", en:"To click"},
        {es:"Duro/a", en:"Hard/difficult"},
        {es:"Al alcance de la mano", en:"Within reach"},
        {es:"Al final de cuentas", en:"After all"},
        {es:"El auricular", en:"Telephone receiver"},
        {es:"El bobo/la boba", en:"Silly/stupid person"},
        {es:"La motosierra", en:"Power saw"},
        {es:"El móvil", en:"Cell phone (mobile)"},
        {es:"El navegante/la navegante", en:"Navigator"},
        {es:"El vagón", en:"Carriage/train car"},
        {es:"Ahorrarse", en:"To save oneself"},
        {es:"Sonar (o-ue)", en:"To ring"},
        {es:"Apagado/a", en:"Turned off"},
        {es:"La bitácora", en:"Travel log/weblog"},
        {es:"La blogonovela", en:"Blog novel"},
        {es:"La blogosfera", en:"Blogosphere"},
        {es:"El enlace", en:"Link"},
        {es:"El novelista/la novelista", en:"Novelist"},
        {es:"El sitio web", en:"Website"},
        {es:"El usuario/la usuaria", en:"User (think Tron)"},
        {es:"La web", en:"The web"},
        {es:"Actualizar", en:"To update (actualmente means currently)"},
        {es:"A la vanguardia", en:"At the forefront (vanguard was the front line in battle)"}
      ],




    
    };

    // --- storage keys and password setup ---
    const STORAGE_KEY = 'svp_chapters_v1';
    const PW_KEY = 'svp_password_b64_v1';
    const DEFAULT_GIST_ID = '094d232a1f9b2db3ef9e627109eb60c9';

    // default password (obfuscated with base64) — default is '01062010D@nesh'
    if(!localStorage.getItem(PW_KEY)) localStorage.setItem(PW_KEY, btoa('01062010D@nesh'));

    function loadChapters(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw){
          // first run: persist the initial chapters into localStorage so stored data
          // becomes authoritative afterwards (adds/removals will persist)
          const copy = JSON.parse(JSON.stringify(initialChapters));
          localStorage.setItem(STORAGE_KEY, JSON.stringify(copy));
          return copy;
        }
        // when stored, merge with initial chapters to ensure all are present
        const loaded = JSON.parse(raw);
        const merged = mergeChapters(loaded, initialChapters);
        // persist the merged version
        saveChapters(merged);
        return merged;
      }catch(e){
        // fallback to initial chapters if anything goes wrong
        return JSON.parse(JSON.stringify(initialChapters));
      }
    }

    function saveChapters(chapters){
      // always save the full chapters object so subsequent loads are authoritative
      localStorage.setItem(STORAGE_KEY, JSON.stringify(chapters));
    }

    // --- elements ---
    const els = {
      chapterSelect: document.getElementById('chapterSelect'),
      direction: document.getElementById('direction'),
      prompt: document.getElementById('prompt'),
      answer: document.getElementById('answer'),
      feedback: document.getElementById('feedback'),
      progressPill: document.getElementById('progressPill'),
      streakPill: document.getElementById('streakPill'),
      startBtn: document.getElementById('startBtn'),
      checkBtn: document.getElementById('checkBtn'),
      idkBtn: document.getElementById('idkBtn'),
      showBtn: document.getElementById('showBtn'),
      stopBtn: document.getElementById('stopBtn'),
      skipBtn: document.getElementById('skipBtn'),
      adminBtn: document.getElementById('adminBtn'),
      adminPanel: document.getElementById('adminPanel'),
      closeAdmin: document.getElementById('closeAdmin'),
      adminChapter: document.getElementById('adminChapter'),
      adminEs: document.getElementById('adminEs'),
      adminEn: document.getElementById('adminEn'),
      adminPassword: document.getElementById('adminPassword'),
      addVocabBtn: document.getElementById('addVocabBtn'),
      quizletText: document.getElementById('quizletText'),
      quizletPassword: document.getElementById('quizletPassword'),
      importQuizletBtn: document.getElementById('importQuizletBtn'),
      adminMsg: document.getElementById('adminMsg'),
      curPassword: document.getElementById('curPassword'),
      newPassword: document.getElementById('newPassword'),
      changePasswordBtn: document.getElementById('changePasswordBtn')
    };

    // --- state ---
    let chapters = loadChapters();
    let items = [], index = -1, current = null;
    let total = 0, correct = 0, streak = 0;
    let locked = false;

    // --- utilities ---
    function shuffle(a){ const arr = [...a]; for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]} return arr; }

    function normalizeSegment(s){
      if(!s) return '';
      s = String(s).toLowerCase();
      s = s.replace(/\(.*?\)/g, '');
      s = s.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
      s = s.replace(/[^a-z0-9ñü\s/]/g, ' ');
      s = s.replace(/\b(to|the|a|an|el|la|los|las|un|una|unos|unas)\b/g, ' ');
      s = s.replace(/\s+/g, ' ').trim();
      return s;
    }

    function isCorrect(input, target){
      const inN = normalizeSegment(input);
      const parts = String(target).split('/').map(p=>normalizeSegment(p)).filter(Boolean);
      if(parts.length===0) return inN === normalizeSegment(target);
      return parts.some(p => p === inN);
    }

    function updatePills(){
      els.progressPill.textContent = items.length ? `${index+1} / ${items.length}` : '0 / 0';
      els.streakPill.textContent = `Streak: ${streak}`;
    }

    function setPrompt(showSpanish){
      if(!current) return;
      els.direction.textContent = showSpanish ? 'Type the English:' : 'Escribe en español:';
      els.prompt.textContent = showSpanish ? current.es : current.en;
      els.answer.dataset.target = showSpanish ? current.en : current.es;
      els.answer.value = '';
      els.answer.focus();
      els.feedback.textContent = '';
      updatePills();
    }

    function next(){ if(locked) return; if(items.length===0){ els.prompt.textContent='No items.'; return; } index=(index+1)%items.length; current = items[index]; const showSpanish = Math.random()<0.5; setPrompt(showSpanish); }

    // --- practice actions ---
    function start(){
      const chap = els.chapterSelect.value;
      if(!chap || !chapters[chap] || chapters[chap].length===0){ els.feedback.textContent='No vocab for this chapter.'; return; }
      items = shuffle(chapters[chap]); index=-1; current=null; total=0; correct=0; streak=0; locked=false; els.feedback.textContent=''; updatePills(); next();
    }

    function check(){ if(!current) return; const input = els.answer.value||''; const target = els.answer.dataset.target||''; total++; if(isCorrect(input,target)){ correct++; streak++; els.feedback.innerHTML = `<span class='ok'>✓ Correct!</span>`; if(!locked) setTimeout(next,550); else{ locked=false; setTimeout(next,550); } } else { streak=0; els.feedback.innerHTML = `<div class='no'>✗ Not quite.</div><div class='hint'>Answer: ${escapeHtml(target)}</div>`; locked=true; } updatePills(); }
    function idk(){ if(!current) return; total++; streak=0; els.feedback.innerHTML = `<div class='no'>✗ Marked as unknown.</div><div class='hint'>Answer: ${escapeHtml(els.answer.dataset.target||'')}</div>`; locked=true; updatePills(); }
    function showAnswer(){ if(!current) return; els.feedback.innerHTML = `<div class='hint'>Answer: ${escapeHtml(els.answer.dataset.target||'')}</div>`; }
    function stopShowing(){ if(!current) return; locked=false; next(); }
    function skip(){ locked=false; next(); }

    function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    // --- admin helpers ---
    function populateChapterSelect(){ 
      els.chapterSelect.innerHTML = ''; 
      Object.keys(chapters).sort().forEach(ch=>{ 
        const opt = document.createElement('option'); 
        opt.value=ch; 
        opt.textContent=ch; 
        els.chapterSelect.appendChild(opt); 
      }); 
    }

    function requirePasswordMatches(pw){ 
      const stored = localStorage.getItem(PW_KEY) || btoa('admin'); 
      return btoa(pw) === stored; 
    }

    function addVocabToChapter(chapter, es, en){ 
      if(!chapter) return false; 
      if(!chapters[chapter]) chapters[chapter]=[]; 
      chapters[chapter].push({es:es.trim(), en:en.trim()}); 
      saveChapters(chapters); 
      populateChapterSelect(); 
      return true; 
    }

    function removeChapter(chapter, pw) {
      if (!requirePasswordMatches(pw)) return false;
      if (!chapters[chapter]) return false;
      
      // Ask for confirmation
      if (!confirm(`Are you sure you want to remove "${chapter}" with ${chapters[chapter].length} vocabulary items? This cannot be undone.`)) {
        return false;
      }

      // Remove from initial chapters if it exists there
      if (initialChapters[chapter]) {
        delete initialChapters[chapter];
      }

      // Remove from current chapters
      delete chapters[chapter];
      saveChapters(chapters);
      populateChapterSelect();
      
      // Reset if current chapter was removed
      if (els.chapterSelect.value === '') {
        els.chapterSelect.selectedIndex = 0;
      }
      
      return true;
    }

    function parseQuizletText(text){
      const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
      const out = [];
      // if tab-separated lines
      if(lines.some(l=>l.includes('\t'))){
        for(const l of lines){ const parts = l.split('\t'); if(parts.length>=2) out.push({es:parts[0].trim(), en:parts[1].trim()}); }
        return out;
      }
      // otherwise assume alternating lines: term, definition
      for(let i=0;i+1<lines.length;i+=2){ out.push({es:lines[i], en:lines[i+1]}); }
      return out;
    }

    // --- GitHub Gist cloud sync helpers ---
    const GIST_ID_KEY = 'svp_gist_id_v1';
    const GITHUB_TOKEN_KEY = 'svp_github_token_v1';

    function getStoredGistId(){ return localStorage.getItem(GIST_ID_KEY) || '' }
    function setStoredGistId(id){ if(id) localStorage.setItem(GIST_ID_KEY, id); else localStorage.removeItem(GIST_ID_KEY); }
    function getStoredGithubToken(){ return localStorage.getItem(GITHUB_TOKEN_KEY) || '' }
    function setStoredGithubToken(t){ if(t) localStorage.setItem(GITHUB_TOKEN_KEY, t); else localStorage.removeItem(GITHUB_TOKEN_KEY); }

    async function publishToGist(pw){
      if(!requirePasswordMatches(pw)) { els.adminMsg.textContent = 'Password incorrect.'; return; }
      try{
        const token = (els.githubToken.value || getStoredGithubToken()).trim();
        const gistIdInput = (els.gistId.value || getStoredGistId()).trim();
        const content = JSON.stringify(chapters, null, 2);
        const files = { 'svp_chapters.json': { content } };

        const headers = { 'Content-Type': 'application/json' };
        if(token) headers['Authorization'] = `token ${token}`;

        let res, body;
        if(gistIdInput){
          // update existing gist
          res = await fetch(`https://api.github.com/gists/${gistIdInput}`, {
            method: 'PATCH', headers, body: JSON.stringify({ files })
          });
        } else {
          // create new gist (public)
          res = await fetch('https://api.github.com/gists', {
            method: 'POST', headers, body: JSON.stringify({ description: 'SVP chapters JSON', public: true, files })
          });
        }

        if(!res.ok){ const txt = await res.text(); els.adminMsg.textContent = `Gist publish failed: ${res.status} ${res.statusText}`; console.error(txt); return; }
        body = await res.json();
        const newId = body.id || gistIdInput;
        setStoredGistId(newId);
        if(token) setStoredGithubToken(token);
        els.gistId.value = newId;
        els.githubToken.value = '';
        els.adminMsg.textContent = `Published to Gist ${newId}.`;
      }catch(e){ console.error(e); els.adminMsg.textContent = 'Publish failed (see console).'; }
    }

    async function syncFromGist(pw){
      if(!requirePasswordMatches(pw)) { els.adminMsg.textContent = 'Password incorrect.'; return; }
      try{
        const gistId = (els.gistId.value || getStoredGistId()).trim();
        if(!gistId){ els.adminMsg.textContent = 'Enter a Gist ID to sync from.'; return; }
        const token = (els.githubToken.value || getStoredGithubToken()).trim();
        const headers = {};
        if(token) headers['Authorization'] = `token ${token}`;
        const res = await fetch(`https://api.github.com/gists/${gistId}`, { headers });
        if(!res.ok){ els.adminMsg.textContent = `Gist fetch failed: ${res.status} ${res.statusText}`; return; }
        const body = await res.json();
        // find file content (prefer svp_chapters.json)
        let fileContent = null;
        if(body.files && body.files['svp_chapters.json']) fileContent = body.files['svp_chapters.json'].content;
        else {
          // pick first file
          const keys = Object.keys(body.files||{});
          if(keys.length) fileContent = body.files[keys[0]].content;
        }
        if(!fileContent){ els.adminMsg.textContent = 'No suitable file found in gist.'; return; }
        const parsed = JSON.parse(fileContent);

        // Ask user whether to overwrite or merge
        const doOverwrite = confirm('Overwrite local chapters with gist content? (Cancel to merge)');
        if(doOverwrite){ chapters = parsed; }
        else { chapters = { ...chapters, ...parsed }; }
        saveChapters(chapters);
        populateChapterSelect();
        setStoredGistId(gistId);
        if(token) setStoredGithubToken(token);
        els.gistId.value = gistId;
        els.githubToken.value = '';
        els.adminMsg.textContent = 'Sync completed.';
      }catch(e){ console.error(e); els.adminMsg.textContent = 'Sync failed (see console).'; }
    }

      // --- safe merge-only fetch (no password required) for auto-sync
      async function fetchGistAndMerge(){
        try{
          const gistId = (els.gistId.value || getStoredGistId()).trim();
          if(!gistId) return; // nothing to do
          const res = await fetch(`https://api.github.com/gists/${gistId}`);
          if(!res.ok){ console.warn('Auto-sync fetch failed', res.status); return; }
          const body = await res.json();
          let fileContent = null;
          if(body.files && body.files['svp_chapters.json']) fileContent = body.files['svp_chapters.json'].content;
          else {
            const keys = Object.keys(body.files||{});
            if(keys.length) fileContent = body.files[keys[0]].content;
          }
          if(!fileContent) return;
          const parsed = JSON.parse(fileContent);
          const merged = mergeChapters(chapters, parsed);
          // If merged changed something, persist and update UI
          if(JSON.stringify(merged) !== JSON.stringify(chapters)){
            chapters = merged;
            saveChapters(chapters);
            populateChapterSelect();
            els.adminMsg.textContent = 'Auto-sync: merged remote chapters.';
          }
        }catch(e){ console.warn('Auto-sync error', e); }
      }

      function mergeChapters(local, remote){
        // safe merge: add missing chapters and missing items without duplicating exact es+en pairs
        const out = JSON.parse(JSON.stringify(local));
        for(const ch of Object.keys(remote||{})){
          if(!out[ch]) out[ch] = [];
          const exists = new Set(out[ch].map(x => `${normalizeSegment(x.es)}|${normalizeSegment(x.en)}`));
          for(const item of remote[ch]){
            const key = `${normalizeSegment(item.es)}|${normalizeSegment(item.en)}`;
            if(!exists.has(key)){
              out[ch].push(item);
              exists.add(key);
            }
          }
        }
        return out;
      }

      let _autoSyncTimer = null;
      function startAutoSync(){
        stopAutoSync();
        const interval = Math.max(10, parseInt((els.autoSyncInterval && els.autoSyncInterval.value) || 60, 10));
        _autoSyncTimer = setInterval(fetchGistAndMerge, interval * 1000);
        // run once immediately
        fetchGistAndMerge();
      }
      function stopAutoSync(){ if(_autoSyncTimer){ clearInterval(_autoSyncTimer); _autoSyncTimer = null; } }

    // --- events ---
    els.startBtn.addEventListener('click', start);
    els.checkBtn.addEventListener('click', check);
    els.idkBtn.addEventListener('click', idk);
    els.showBtn.addEventListener('click', showAnswer);
    els.stopBtn.addEventListener('click', stopShowing);
    els.skipBtn.addEventListener('click', skip);

    document.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ if(document.activeElement===els.answer){ e.preventDefault(); check(); } } if(e.key==='ArrowRight'){ if(!locked) next(); } if(e.key==='Escape'){ if(locked) stopShowing(); } });

    els.adminBtn.addEventListener('click', ()=>{ els.adminPanel.classList.add('show'); els.adminPanel.setAttribute('aria-hidden','false'); els.adminMsg.textContent=''; els.adminChapter.value = els.chapterSelect.value || '' });
    els.closeAdmin.addEventListener('click', ()=>{ els.adminPanel.classList.remove('show'); els.adminPanel.setAttribute('aria-hidden','true'); });
    
    // Add remove chapter functionality
    els.removeChapterBtn = document.getElementById('removeChapterBtn');
    els.removeChapterBtn.addEventListener('click', () => {
      const chapter = (els.adminChapter.value || '').trim();
      const pw = els.adminPassword.value || '';
      
      if (!chapter) {
        els.adminMsg.textContent = 'Please enter a chapter name.';
        return;
      }
      
      if (!chapters[chapter]) {
        els.adminMsg.textContent = 'Chapter not found.';
        return;
      }
      
      if (removeChapter(chapter, pw)) {
        els.adminMsg.textContent = `Chapter "${chapter}" removed successfully.`;
        els.adminChapter.value = '';
        els.adminPassword.value = '';
        // auto-publish if enabled
        try{ if(els.autoPublish && els.autoPublish.checked){ const token = els.githubToken.value || getStoredGithubToken(); if(token){ publishToGist(pw); } } }catch(e){ console.warn('Auto-publish failed', e); }
      } else {
        els.adminMsg.textContent = 'Incorrect password or operation cancelled.';
      }
    });

    els.addVocabBtn.addEventListener('click', ()=>{
      const pw = els.adminPassword.value || '';
      if(!requirePasswordMatches(pw)){ els.adminMsg.textContent = 'Password incorrect.'; return; }
      const ch = (els.adminChapter.value || '').trim(); const es = (els.adminEs.value || '').trim(); const en = (els.adminEn.value || '').trim();
      if(!ch || !es || !en){ els.adminMsg.textContent = 'Fill chapter, Spanish and English.'; return; }
      addVocabToChapter(ch, es, en);
      els.adminMsg.textContent = `Added to ${ch}.`;
      els.adminEs.value=''; els.adminEn.value=''; saveChapters(chapters);
      // auto-publish if enabled and token present
      try{
        if(els.autoPublish && els.autoPublish.checked){ const token = els.githubToken.value || getStoredGithubToken(); if(token){ publishToGist(pw); } }
      }catch(e){ console.warn('Auto-publish failed', e); }
    });

    els.importQuizletBtn.addEventListener('click', ()=>{
      const pw = els.quizletPassword.value || '';
      if(!requirePasswordMatches(pw)){ els.adminMsg.textContent = 'Password incorrect.'; return; }
      const ch = (els.adminChapter.value || '').trim(); if(!ch){ els.adminMsg.textContent='Enter chapter name.'; return; }
      const parsed = parseQuizletText(els.quizletText.value || ''); if(parsed.length===0){ els.adminMsg.textContent='No valid pairs found.'; return; }
      if(!chapters[ch]) chapters[ch]=[];
      for(const p of parsed){ chapters[ch].push({es:p.es, en:p.en}); }
      saveChapters(chapters); populateChapterSelect(); els.adminMsg.textContent = `Imported ${parsed.length} items into ${ch}.`;
      els.quizletText.value='';
      // auto-publish if enabled and token present
      try{
        if(els.autoPublish && els.autoPublish.checked){ const token = els.githubToken.value || getStoredGithubToken(); if(token){ publishToGist(pw); } }
      }catch(e){ console.warn('Auto-publish failed', e); }
    });

    // publish/sync buttons
    els.publishGistBtn = document.getElementById('publishGistBtn');
    els.syncGistBtn = document.getElementById('syncGistBtn');
    els.gistId = document.getElementById('gistId');
    els.githubToken = document.getElementById('githubToken');

    els.publishGistBtn.addEventListener('click', async ()=>{
      const pw = els.adminPassword.value || '';
      els.adminMsg.textContent = 'Publishing...';
      await publishToGist(pw);
    });

    els.syncGistBtn.addEventListener('click', async ()=>{
      const pw = els.adminPassword.value || '';
      els.adminMsg.textContent = 'Syncing...';
      await syncFromGist(pw);
    });

    // auto-sync toggle handler
    els.autoSync = document.getElementById('autoSync');
    els.autoSyncInterval = document.getElementById('autoSyncInterval');
    els.autoPublish = document.getElementById('autoPublish');
    // initialize from stored gist id or default
    const storedId = getStoredGistId();
    if(storedId) {
      els.gistId.value = storedId;
    } else {
      els.gistId.value = DEFAULT_GIST_ID;
      setStoredGistId(DEFAULT_GIST_ID);
    }
    if(getStoredGithubToken()) els.githubToken.value = ''; // don't prefill token field for safety
    
    // Enable auto-sync by default
    els.autoSync.checked = true;
    startAutoSync();

    // start auto sync if enabled by default
    els.autoSync.addEventListener('change', ()=>{
      if(els.autoSync.checked) startAutoSync(); else stopAutoSync();
    });

    // stop timer on page unload
    window.addEventListener('beforeunload', ()=>{ stopAutoSync(); });

    els.changePasswordBtn.addEventListener('click', ()=>{
      const cur = (els.curPassword.value||''); const nw = (els.newPassword.value||'');
      if(!requirePasswordMatches(cur)){ els.adminMsg.textContent='Current password incorrect.'; return; }
      if(!nw){ els.adminMsg.textContent='Enter a new password.'; return; }
      localStorage.setItem(PW_KEY, btoa(nw)); els.adminMsg.textContent='Password changed.'; els.curPassword.value=''; els.newPassword.value='';
    });

    // --- init ---
    populateChapterSelect();
    updatePills();

  </script>
</body>
</html>
